<html>
    <head>
        <title>
            Learn Machine Learning
        </title>
        <style>
            canvas {
                border: solid 2px;
            }
            
        </style>
        <script>
            var SIZE = 300
            var CANVAS = null
            var INTERVAL = 42
            var THRESHOLD = 155

            function main() {
                CANVAS = document.getElementById('camera')
                CANVAS.width = SIZE
                CANVAS.height = SIZE

                var constraints = { video : true};
                var permission = navigator.mediaDevices.getUserMedia(constraints)
                permission.then(
                    function(stream){
                        var video = document.createElement('video')
                        video.srcObject = stream
                        video.play()
                        setInterval(updateImage, INTERVAL, video)
                    }
                    
                ).catch(
                    function(err){
                        alert("camera error")
                    }
                )
            }

            function updateImage(video){
                var context = CANVAS.getContext('2d')
                var minSize = Math.min(video.videoWidth, video.videoHeight )
                var startX = (video.videoWidth - minSize) / 2
                var startY = (video.videoHeight - minSize) / 2
                
                context.drawImage(video, startX, startY, minSize, minSize, 0, 0, SIZE, SIZE)
            
                var image = context.getImageData(0,0,SIZE,SIZE)
                var matrix = getPixelMatrix(image.data)
                processMatrix(matrix)
            }

            function processMatrix(matrix){
                isolateMatrix(matrix)
                //updateCanvas(matrix)
            }

            function isolateMatrix(matrix){
                for (var i=1; i <= SIZE; i++){
                    for (var j=1; j<=SIZE; j++){
                        if (matrix[i][j] < THRESHOLD){
                            matrix[i][j] = 0
                        } else {
                            matrix[i][j] = 255
                        }
                    }
                }
            }

            function getPixelMatrix(dataArray){
                var matrix = []
                for (var i=1; i<=SIZE; i++){
                    matrix[i] = []
                    for (var j=1; j<=SIZE; j++){
                        var groupIndex = (i - 1) * SIZE * 4 + (j - 1) * 4
                        var red = dataArray[groupIndex + 0]
                        var green = dataArray[groupIndex + 1]
                        var blue = dataArray[groupIndex + 2]
                        matrix[i][j] = (red + green + blue) / 3

                    }
                }
                return matrix;
            }
        </script>
    </head>
    <body onload="main()">
        <div>
        <center>
            <canvas id="camera"></canvas>

            <div id="output">?</div>
            <br>
            <input id="objectName" type="text" placeholder="what is this?" />
            <button class="button">Learn</button>
        </center>
        </div>
    </body>
</html>